/**
 * Auth Registry Generator
 *
 * Generates auth-registry.ts
 *
 * @module core/scripts/build/registry/generators/auth-registry
 */

/**
 * Generate auth registry file
 *
 * @param {Array} authConfigs - Auth configurations from discovery
 * @returns {string} Generated TypeScript content
 */
export function generateAuthRegistry(authConfigs) {
  const authData = authConfigs.reduce((acc, config) => {
    acc[config.type] = config.data
    return acc
  }, {})

  return `/**
 * Auth Configuration Registry
 *
 * Generated at: ${new Date().toISOString()}
 * Auth configs discovered: ${authConfigs.length}
 *
 * This file contains centralized auth configuration for roles, scopes, and filters.
 * Replaces hardcoded values in helpers.ts and other auth-related files.
 *
 * DO NOT EDIT - This file is auto-generated by scripts/build-registry.mjs
 */

export interface AuthConfig {
  scopes: {
    base: string[]
    roles: Record<string, string[]>
    flags: Record<string, string[]>
    restrictions: Record<string, {
      remove?: string[]
      allow_only?: string[]
    }>
  }
  filters: {
    allowed: string[]
  }
}

export const AUTH_CONFIG: AuthConfig = ${JSON.stringify(authData, null, 2)}

/**
 * Get base scopes for authentication
 */
export function getBaseScopes(): string[] {
  return AUTH_CONFIG.scopes?.base || []
}

/**
 * Get scopes for a specific role
 */
export function getRoleScopes(role: string): string[] {
  return AUTH_CONFIG.scopes?.roles?.[role] || []
}

/**
 * Get scopes for a specific flag
 */
export function getFlagScopes(flag: string): string[] {
  return AUTH_CONFIG.scopes?.flags?.[flag] || []
}

/**
 * Get allowed API filters
 */
export function getAllowedFilters(): string[] {
  return AUTH_CONFIG.filters?.allowed || []
}

/**
 * Get restriction rules for a flag
 */
export function getRestrictionRules(flag: string): { remove?: string[], allow_only?: string[] } {
  return AUTH_CONFIG.scopes?.restrictions?.[flag] || {}
}
`
}
