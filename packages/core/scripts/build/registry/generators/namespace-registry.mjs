/**
 * Namespace Registry Generator
 *
 * Generates namespace-registry.ts
 *
 * @module core/scripts/build/registry/generators/namespace-registry
 */

/**
 * Generate translation namespace configurations registry for i18n-integration.ts
 *
 * @param {Array} entities - Discovered entities
 * @param {object} config - Configuration object from getConfig()
 * @returns {string} Generated TypeScript content
 */
export function generateNamespaceRegistry(entities, config) {
  // Core namespaces (always available)
  const coreNamespaces = ['common', 'dashboard', 'settings', 'auth', 'public', 'validation', 'superadmin', 'admin', 'teams']

  // Entity namespaces (generated from entities)
  const entityNamespaces = entities
    .filter(entity => entity.translations && entity.features?.enabled)
    .map(entity => entity.translations.namespace || entity.name)

  // Route-based namespace mappings
  const routeNamespaces = {
    'DASHBOARD_AUTHENTICATED': {
      core: ['common', 'dashboard', 'settings', 'public', 'validation', 'teams', 'admin'],
      entities: entityNamespaces,
      strategy: 'DASHBOARD_AUTHENTICATED'
    },
    'AUTH_ONLY': {
      core: ['common', 'auth', 'validation'],
      entities: [],
      strategy: 'AUTH_ONLY'
    },
    'PUBLIC_INITIAL': {
      core: ['common', 'public', 'auth'],
      entities: entityNamespaces.filter(ns => {
        // Only include entities that should be visible on public pages
        const entity = entities.find(e => (e.translations?.namespace || e.name) === ns)
        return entity?.visibility?.public !== false
      }),
      strategy: 'PUBLIC_INITIAL'
    },
    'SUPERADMIN': {
      core: ['common', 'superadmin', 'dashboard'],
      entities: entityNamespaces,
      strategy: 'SUPERADMIN'
    },
    'UNKNOWN_FALLBACK': {
      core: ['common', 'public'],
      entities: [],
      strategy: 'UNKNOWN_FALLBACK'
    }
  }

  // Generate entity paths for route detection
  const entityPaths = entities
    .filter(entity => entity.api && entity.features?.enabled)
    .map(entity => `/${entity.api.apiPath || entity.name}`)

  const namespaceConfig = {
    core: coreNamespaces,
    entities: entityNamespaces,
    routes: routeNamespaces,
    entityPaths: entityPaths
  }

  return `/**
 * Auto-generated Translation Namespace Registry
 *
 * Generated at: ${new Date().toISOString()}
 * Core namespaces: ${coreNamespaces.length}
 * Entity namespaces: ${entityNamespaces.length}
 * Route strategies: ${Object.keys(routeNamespaces).length}
 * Entity paths: ${entityPaths.length}
 *
 * This file replaces hardcoded namespace configurations in i18n-integration.ts
 *
 * DO NOT EDIT - This file is auto-generated by scripts/build-registry.mjs
 */

export interface RouteNamespaceConfig {
  core: string[]
  entities: string[]
  strategy: string
}

export interface NamespaceConfig {
  core: string[]
  entities: string[]
  routes: Record<string, RouteNamespaceConfig>
  entityPaths: string[]
}

export const NAMESPACE_CONFIG: NamespaceConfig = ${JSON.stringify(namespaceConfig, null, 2)}

// ==================== Service Layer ====================
// Query functions have been moved to: @nextsparkjs/core/lib/services/namespace.service
// Import from there instead:
// import { NamespaceService } from '@nextsparkjs/core/lib/services/namespace.service'
// - NamespaceService.getCoreNamespaces() - Get core namespaces
// - NamespaceService.getEntityNamespaces() - Get entity namespaces
// - NamespaceService.getOptimizedNamespaces(strategy) - Get optimized namespaces
// - NamespaceService.detectRouteStrategy(pathname) - Detect route strategy
// - NamespaceService.getEntityPaths() - Get entity paths
`
}
