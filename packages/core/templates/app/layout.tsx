/**
 * AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY
 * Generated by @nextspark/core
 * Regenerate with: npx nextspark generate
 */

import type { Metadata } from "next"
import { Geist, Geist_Mono } from "next/font/google"
import { NextIntlClientProvider } from 'next-intl'
import { getMessages } from 'next-intl/server'

import "./globals.css"
import { QueryProvider } from "@nextsparkjs/core/providers/query-provider"
import { ThemeProvider as NextThemeProvider } from "@nextsparkjs/core/providers/theme-provider"
import { ThemeProvider as CustomThemeProvider } from "@nextsparkjs/core/lib/theme/ThemeProvider"
import { TeamProvider } from "@nextsparkjs/core/contexts/TeamContext"
import { SubscriptionProvider } from "@nextsparkjs/core/contexts/SubscriptionContext"
import { getUserLocale } from '@nextsparkjs/core/lib/locale'
import { Toaster } from "@nextsparkjs/core/components/ui/sonner"
import { TranslationContextManager } from "@nextsparkjs/core/providers/TranslationContextManager"
import { PluginService } from '@nextsparkjs/core/lib/services'
import { getMetadataOrDefault } from '@nextsparkjs/core/lib/template-resolver'
import { getThemeSettings } from '@nextsparkjs/core/lib/theme/get-default-theme-mode'

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
})

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
})

const defaultMetadata: Metadata = {
  title: "NextSpark App",
  description: "Built with NextSpark",
}

export const metadata: Metadata = getMetadataOrDefault(
  'app/layout.tsx',
  defaultMetadata
)

let pluginsInitialized = false

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  if (!pluginsInitialized) {
    await PluginService.initializeAll()
    pluginsInitialized = true
  }

  const locale = await getUserLocale()
  const messages = await getMessages({ locale })
  const { defaultMode, allowUserToggle } = await getThemeSettings()

  return (
    <html lang={locale} suppressHydrationWarning>
      <head>
        {/* Preconnect hints for Stripe - improves payment form load time */}
        <link rel="dns-prefetch" href="https://js.stripe.com" />
        <link rel="dns-prefetch" href="https://api.stripe.com" />
        <link rel="preconnect" href="https://js.stripe.com" crossOrigin="anonymous" />
        <link rel="preconnect" href="https://api.stripe.com" crossOrigin="anonymous" />
      </head>
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <NextIntlClientProvider messages={messages}>
          <NextThemeProvider
            attribute="class"
            defaultTheme={defaultMode}
            // When allowUserToggle is false, force the theme and ignore localStorage/system
            forcedTheme={!allowUserToggle ? defaultMode : undefined}
            // Only detect OS preference when theme configures defaultMode: 'system' AND user can toggle
            enableSystem={allowUserToggle && defaultMode === 'system'}
            disableTransitionOnChange
          >
            <CustomThemeProvider>
              <QueryProvider>
                <TeamProvider>
                  <SubscriptionProvider>
                    <TranslationContextManager />
                    <main>{children}</main>
                    <Toaster position="bottom-left" />
                  </SubscriptionProvider>
                </TeamProvider>
              </QueryProvider>
            </CustomThemeProvider>
          </NextThemeProvider>
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
